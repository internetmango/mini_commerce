!!!
%html
  %head
    %meta{content: "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{charset: "utf-8"}/
    %title Bootstrap 4 Dashboard
    %base{target: "_self"}/
    %meta{content: "A Bootstrap 4 admin dashboard theme that will get you started. The sidebar toggles off-canvas on smaller screens. This example also include large stat blocks, modal and cards. The top navbar is controlled by a separate hamburger toggle button.", name: "description"}/
    %meta{content: "width=device-width, initial-scale=1.0", name: "viewport"}/
    %meta{name: "google", value: "notranslate"}/
    %link{href: "/images/cp_ico.png", rel: "shortcut icon"}/


  %body
    #main.container-fluid
      .row.row-offcanvas.row-offcanvas-left
        .col-md-15.col-lg-20.main
          %h1.display-2.hidden-xs-down
            Mini Shop Dashboard
          .row.mb-3
            .col-xl-3.col-lg-6
              .card.card-inverse.card-success
                .card-block.bg-success
                  .rotate
                    %i.fa.fa-user.fa-5x
                  .text-center
                    %h6.text-uppercase Orders
                    %h1.display-1 
                      = @orders_count_today
            .col-xl-3.col-lg-6
              .card.card-inverse.card-danger
                .card-block.bg-info
                  .rotate
                    %i.fa.fa-list.fa-4x
                  .text-center
                    %h6.text-uppercase New Users
                    %h1.display-1 
                      = @new_users_count_today
            .col-xl-3.col-lg-6
              .card.card-inverse.card-info
                .card-block.bg-danger
                  .rotate
                    %i.fa.fa-twitter.fa-5x
                  .text-center
                    %h6.text-uppercase Low Stock
                    %h1.display-1 
                      = @low_stock_count
            .col-xl-3.col-lg-6
              .card.card-inverse.card-warning
                .card-block.bg-warning
                  .rotate
                    %i.fa.fa-share.fa-5x
                  .text-center
                    %h6.text-uppercase Sales
                    %h1.display-1 36
          %hr/
          %br/
          %h3.text-center Confirmed orders of last 5 days
          .row.no-gutters
            .col-12
              .py-3
                %br/
                - if @confirmed_orders_last_5_days.blank?
                  %p
                    %b No orders found
                - else
                  %table.table.table-striped.table-sm.table-bordered.table-responsive-sm
                    %thead.bg-secondary.text-light
                      %tr
                        %th Order Number
                        %th User
                        %th Status
                        %th Total amount
                        %th Action
                    %tbody
                      - @confirmed_orders_last_5_days.each do |order|
                        %tr
                          %td
                            = link_to order.order_number, admin_order_path(order)
                          %td= User.find(order.user_id).name
                          %td
                            -if order.deleted_at
                              %span{'data-feather' => 'trash-2'}
                            -elsif order.status == 'confirmed'
                              %span{'data-feather' => 'thumbs-up'}
                            -elsif order.status && !order.deleted_at
                              %span{'data-feather' => 'shopping-cart'}
                            = order.status
                          %td= order.total_amount
                          %td
                            %span>
                              = link_to edit_admin_order_path(order), class: 'nav-link' do
                                %span{'data-feather' => 'edit'}

                  = pagy_bootstrap_nav(@pagy).html_safe
          %hr/
          %br/
          %h3.text-center Incomplete orders of last 5 days
          .row.no-gutters
            .col-12
              .py-3
                %br/
                - if @incompleted_orders_last_5_days.blank?
                  %p
                    %b No orders found
                - else
                  %table.table.table-striped.table-sm.table-bordered.table-responsive-sm
                    %thead.bg-secondary.text-light
                      %tr
                        %th Order Number
                        %th User
                        %th Status
                        %th Total amount
                        %th Action
                    %tbody
                      - @incompleted_orders_last_5_days.each do |order|
                        %tr
                          %td
                            = link_to order.order_number, admin_order_path(order)
                          %td= User.find(order.user_id).name
                          %td
                            -if order.deleted_at
                              %span{'data-feather' => 'trash-2'}
                            -elsif order.status == 'confirmed'
                              %span{'data-feather' => 'thumbs-up'}
                            -elsif order.status && !order.deleted_at
                              %span{'data-feather' => 'shopping-cart'}
                            = order.status
                          %td= order.total_amount
                          %td
                            %span>
                              = link_to edit_admin_order_path(order), class: 'nav-link' do
                                %span{'data-feather' => 'edit'}

                  = pagy_bootstrap_nav(@pagy).html_safe

          %hr/
          %br/
          %h3.text-center New orders rate - last week
          %script{src: "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"}
          #center    
            %canvas#canvas{height: "400", width: "600"}
              - keys = @new_orders_chart_data.keys.to_s
              - values = @new_orders_chart_data.values.to_s
              %input#keys{type: "hidden", value: keys}/
              %input#values{type: "hidden", value: values}/

          %hr/
          %br/
          %h3.text-center New users rate - last week
          %script{src: "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"}
          #center
            %canvas#users{height: "400", width: "600"}
          :javascript
            var ctx = document.getElementById("users").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: #{@new_customers_chart_data.keys.to_json.html_safe},
                    datasets: [{
                        label: '# of users',
                        data: #{@new_customers_chart_data.values.to_json.html_safe},
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 9
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });  